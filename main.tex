\documentclass[10pt,a4paper]{article}

\input{AEDmacros}
\usepackage{caratula} % Version modificada para usar las macros de algo1 de ~> https://github.com/bcardiff/dc-tex
\usepackage{titlesec}

\setcounter{secnumdepth}{4}

\titleformat{\paragraph}
{\normalfont\normalsize\bfseries}{\theparagraph}{1em}{}
\titlespacing*{\paragraph}
{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}

\titulo{Trabajo práctico 1}
\subtitulo{Especificación y WP}

\fecha{\today}

\materia{Algoritmos y Estructura de Datos}
\grupo{SinGrupo4}

\integrante{Algañaraz, Franco}{1092/22}{francoarga10@gmail.com}
\integrante{Illescas, Marcos}{390/14}{marcosillescas90@gmail.com}
\integrante{Bahamonde, Matias}{694/21}{matubaham@gmail.com}
\integrante {Marión, Ian Pablo}{004/01}{ianfrodin@gmail.com}
% Pongan cuantos integrantes quieran

% Declaramos donde van a estar las figuras
% No es obligatorio, pero suele ser comodo
\graphicspath{{../static/}}

\begin{document}

\maketitle

\section{Especificación}

\pred{habitantesPositivos}{\In s: \TLista{Ciudad}}{
(\forall j: \ent)(0 \leq j < |s| \implicaLuego s[j].habitantes \geq 0)
}

\pred{noCiudadesRepetidas}{\In s: \TLista{Ciudad}}{
(\forall i: \ent)(\forall j: \ent)(0 \leq i < j < |s| \implicaLuego s[i].nombre \neq s[j].nombre)
}

\subsection{grandesCiudades}

\begin{proc}{grandesCiudades}{\In ciudades: \TLista{Ciudad}}{\TLista{Ciudad}}
	\requiere{habitantesPositivos(ciudades) \wedge noCiudadesRepetidas(ciudades)}
	\asegura{\longitud{res} = CantidadCiudadesMayor50000(ciudades) \; \wedge \\
          (\forall i: \ent)(0 \leq i < \longitud{res} \implicaLuego (\exists j: \ent)(0 \leq j < \longitud{ciudades} \yLuego (res[i] = ciudades[j] \wedge ciudades[j].habitantes > 50000)))}
\end{proc}


\aux{CantidadCiudadesMayor50000}{\In s: \TLista{Ciudad}}{\ent} \\ {$\sum_{i=0}^{|s|-1} \IfThenElse{s[i].habitantes > 50000}{1}{0}$;}

\subsection{sumaDeHabitantes}

\begin{proc}{sumaDeHabitantes}{\In menoresDeCiudades: \TLista{Ciudad}, \In mayoresDeCiudades: \TLista{Ciudad}}{\TLista{Ciudad}}
	\requiere{|menoresDeCiudades| = |mayoresDeCiudades| \; \; \wedge \; \\
          mismosNombres(menoresDeCiudades, mayoresDeCiudades) \; \; \wedge \\
          habitantesPositivos(menoresDeCiudades) \; \; \wedge \; \; habitantesPositivos(mayoresDeCiudades) \; \; \wedge \\
          noCiudadesRepetidas(menoresDeCiudades) \; \; \wedge \; \; noCiudadesRepetidas(mayoresDeCiudades)} 
	\asegura{|res| = |menoresDeCiudades| \; \wedge \\
          (\forall i: \ent)(0 \leq i < |res| \implicaLuego (\exists j: \ent)(\exists k: \ent)(0 \leq j < k < |menoresDeCiudad| \; \yLuego \\ siCoincidenNombresSumoHabitantes(res, menoresDeCiudades, mayoresDeCiudades, i, j, k)))}
\end{proc}

\pred{mismosNombres}{\In s: \TLista{Ciudad}, \In t: \TLista{Ciudad}}{(\forall i: \ent) (0 \leq i < |s| \implicaLuego (\exists j: \ent) (0 \leq j < |t| \yLuego s[i].nombre = t[j].nombre))}

\pred{siCoincidenNombresSumoHabitantes}{\In s: \TLista{Ciudad}, \In t: \TLista{Ciudad}, \In r: \TLista{Ciudad}, \In i: \ent, \In j: \ent, \In k: \ent}{(s[i].nombre = t[j].nombre \; \wedge \;  s[i].nombre = r[k].nombre) \longrightarrow  s[i].habitantes = t[j].habitantes + r[k].habitantes}


\subsection{hayCamino}

\begin{proc}{hayCamino}{\In distancias : \TLista{\TLista{\ent}}, \In desde : \ent, \In hasta : \ent}{\bool}
	\requiere{0 \leq desde < |distancias| \land 0 \leq hasta < |distancias|}
	\asegura{res = \True \iff existeCamino(distancia, desde, hasta)}
\end{proc}

\pred{existeCamino}{\In distancias : \TLista{\TLista{\ent}}, \In desde : \ent, \In hasta : \ent}{\existe[unalinea]{camino}{\TLista{\ent}}{|camino| \geq 2 \land camino[0] = desde \land camino[|camino| - 1] = hasta \land 
          (\forall i: \ent)(0 \leq i < |camino| - 1 \rightarrow distancias[camino[i]][camino[i+1]] > 0)}}

\subsection{cantidadCaminosNSaltos}

\begin{proc}{cantidadCaminosNSaltos}{\Inout conexion : \TLista{\TLista{\ent}}, \In n : \ent}
	\requiere{n \geq 1 \land conexion = C_0}
	\asegura{(\forall i: \ent)(0 \leq i < \longitud{C_0} \implicaLuego (\forall j: \ent)(0 \leq j < \longitud{C_0} \implicaLuego (\forall k: \ent)(0 \leq k < \longitud{C_0} \implicaLuego conexion[i][j] = {\sum_{i=0}^{|camino|-2} ({C_0}[i][k]{C_0}[j][k])^n)) \yLuego longitud{C_0[i]} = longitud{conexion[i]})}
\end{proc}
        \asegura{longitud{conexion} = longitud{C_0}}

\subsection{caminoMínimo}

\begin{proc}{caminoMinimo}{\In origen : \nat, \In destino : \ent, \In distancias : \TLista{\TLista{\ent}}}{\TLista{\ent}}
	\requiere{0 \leq origen < |distancias| \land 0 \leq destino < |distancias|}
	\asegura{(res = \lvacia \iff ¬existeCamino(distancias, origen, destino) \lor origen = destino) \land (res \neq \lvacia \implies (\forall camino : \TLista{\ent})(camino[0] = origen \land camino[|camino| - 1] = destino \land sumaDistancias(res, distancias) \leq sumaDistancias(camino, distancias)))}
    \aux{sumaDistancia}{\In camino : \TLista{\ent}, \In distancias : \TLista{\TLista{\ent}}}{\ent}{\sum_{i=0}^{|camino|-2} distancias[camino[i]][camino[i+1]]}
\end{proc}



\section{Demostraciones de correctitud}

\subsection{Demostrar que la implementación es correcta con respecto a la especificación.}


\begin{proc}
{poblacionTotal}{\In ciudades: \TLista{Ciudad}}{\ent}
\requiere{(\exists j: \ent)(0 \leq j < |ciudades| \yLuego ciudades[j].habitantes > 50000) \wedge \\
(\forall k: \ent)(0 \leq k < |ciudades| \implicaLuego ciudades[i].habitantes \geq 0) \wedge \\
(\forall m: \ent)(\forall n: \ent)(0 \leq m < n < |ciudades| \implicaLuego ciudades[m].nombre \neq ciudades[n].nombre)
}
\asegura{res = \sum_{i=0}^{|ciudades|-1} ciudades[i].habitantes}    
\end{proc}


$ \\

S_{1}: res = 0 

S_{2}: i = 0 

while \; (i  \textless \; ciudades.length) \; do  \par \par
         S_{3}: res = res + ciudades.[i].habitantes \par
     
         S_{4}: i = i + 1 
     
endwhile    $
\\ \\

$P \equiv A \wedge B \wedge C$

$A \equiv (\exists l: \ent)(0 \leq l < |ciudades| \yLuego ciudades[l].habitantes > 50000)$ \par
$B \equiv (\forall k: \ent)(0 \leq k < |ciudades| \implicaLuego ciudades[k].habitantes \geq 0)$ \par
$C \equiv (\forall m: \ent)(\forall n: \ent)(0 \leq m < n < |ciudades| \implicaLuego ciudades[m].nombre \neq ciudades[n].nombre)$
\\ \par
$Pc \equiv res = 0 \; \wedge i = 0 \; \wedge A \wedge B \wedge C$
\\ \par

$B \equiv i < |ciudades|$
\\ \par

$I \equiv 0 \leq i \leq |ciudades| \yLuego res = \sum_{j=0}^{i-1} ciudades[j].habitantes$
\\ \par

$f_{v} \equiv |ciudades| - i$
\\ \par

Como el programa finaliza al terminar el ciclo, podemos asumir que: \par
\vspace{5px}

$Q \equivQc \equiv res = \sum_{j=0}^{|ciudades|-1} ciudades[j].habitantes$
\\

Para demostrar la correctitud del programa basta ver que son válidas las siguientes triplas de Hoare: \par
\vspace{5px}

{ \{Pc\} S_{3};S_{4} \{Qc \equiv{Q}\} \; y \; \{P\} S_{1};S_{2} \{Pc\}}
\vspace{5px}


\subsubsection{$Pc \implies wp(S_{3};S_{4},Qc)$ (Teorema del Invariante y Terminación)}

\paragraph{$Pc \implies I$}
$ Pc \equiv {res = 0 \; \wedge i = 0 \; \wedge A \wedge B \wedge C} \implies 0 \leq 0  \leq |ciudades| \yLuego 0 = \sum_{j=0}^{-1} ciudades[j].habitantes $ \equiv \par 
{\center $ 0 \leq |ciudades| \yLuego 0 = 0 \equiv$ \\
\vspace{5px}
$ True \; \yLuego \; True \equiv$ \\
\vspace{5px}
$True$ \\
\vspace{5px}
$Pc \implies I\par$}

\paragraph{$I \wedge B \implies wp(S_{3};S_{4}, I)$}
$wp(S_{3};S_{4}, I) \equiv wp(res = res + ciudades.[i].habitantes, \; wp(i = i + 1, I))$ \equiv \par
\vspace{5px}
$wp(res = res + ciudades.[i].habitantes, \; def(i+1) \yLuego I_{i+1}^{i})$ \equiv \par
\vspace{5px}
$wp(res = res + ciudades.[i].habitantes, \; True \yLuego 0 \leq i + 1 \leq |ciudades| \yLuego res = \sum_{j=0}^{i}{ciudades[j].habitantes})$ \equiv \par
\vspace{5px}
$wp(res = res + ciudades.[i].habitantes, \; \underbrace{-1 \leq i \leq |ciudades| - 1 \yLuego res = \sum_{j=0}^{i}{ciudades[j].habitantes}}_{I^{'}})$ \equiv \par
\vspace{5px}
$def(res + ciudades.[i].habitantes) \yLuego (I^{'})_{res + ciudades.[i].habitantes}^{res}$ \equiv \par
\vspace{5px}
$0 \leq i < |ciudades| \; \yLuego $ -1 \leq i \leq |ciudades| - 1 \yLuego res + ciudades.[i].habitantes = \sum_{j=0}^{i}{ciudades[j].habitantes}$ \equiv \par
\vspace{5px}
$0 \leq i < |ciudades| \yLuego res = \sum_{j=0}^{i-1}{ciudades[j].habitantes}$ \par
\vspace{20px}

$I \wedge B \equiv 0 \leq i \leq |ciudades| \yLuego res = \sum_{j=0}^{i-1} ciudades[j].habitantes \wedge i < |ciudades| \equiv$\par

\begin{center}
$0 \leq i < |ciudades| \yLuego res = \sum_{j=0}^{i-1} ciudades[j].habitantes  \implies  $ \par
\vspace{5px}
$ 0 \leq i < |ciudades| \yLuego \sum_{j=0}^{i-1} ciudades[j].habitantes = \sum_{j=0}^{i-1} ciudades[j].habitantes$ \equiv \par
\vspace{5px}
$True \yLuego True$ \equiv \par
\vspace{5px}
$True$\par
\vspace{5px}
    $I \wedge B \implies wp(S_{3};S_{4}, I)$
\end{center}

\paragraph{$I \wedge \neg B \implies Qc$}
$I \wedge \neg B \equiv 0 \leq i \leq |ciudades| \yLuego res = \sum_{j=0}^{i-1} ciudades[j].habitantes \wedge i \geq |ciudades| $ \equiv \par

\begin{center}
  $i = |ciudades| \yLuego res = \sum_{j=0}^{i-1} ciudades[j].habitantes$ \equiv \par
\vspace{5px}  
$res = \sum_{j=0}^{|ciudades|-1} ciudades[j].habitantes$ \implies \par
\vspace{5px} 
$\sum_{j=0}^{|ciudades|-1} ciudades[j].habitantes = \sum_{j=0}^{|ciudades|-1} ciudades[j].habitantes$ \equiv \par
\vspace{5px}
$True \yLuego True$ \equiv \par
\vspace{5px}
$True$\par
\vspace{5px}
$I \wedge \neg B \implies Qc$
\end{center}

\paragraph{$I \wedge  B \wedge v_{0}=f_{v} \implies wp(S_{3};S_{4}, f_{v} < v_{0})$}

$wp(S_{3};S_{4}, f_{v} < v_{0}) \equiv wp(res = res + ciudades[i].habitantes, wp(i = i + 1, |ciudades| - i < v_{0}))$ \equiv \par
\vspace{5px}
$wp(res = res + ciudades[i].habitantes, def(i+1) \yLuego (|ciudades| - i < v_{0})_{i+1}^{i}) $ \equiv \par
\vspace{5px}
$wp(res = res + ciudades[i].habitantes, True \yLuego |ciudades| - i - 1 < v_{0})$ \equiv \par
\vspace{5px}
$def(res + ciudades[i].habitante) \yLuego (|ciudades| - i - 1 < v_{0})_{res + ciudades[i].habitante}^{res}$ \equiv \par
\vspace{5px}
$0 \leq i < |ciudades| \yLuego |ciudades| - i - 1 < v_{0}$ \equiv \par
\vspace{20px}
$I \wedge  B \wedge v_{0}=f_{v} \equiv 0 \leq i \leq |ciudades| \yLuego res = \sum_{j=0}^{i-1} ciudades[j].habitantes \wedge i < |ciudades| \wedge v_{0}=|ciudades| - i$ \equiv \par
\begin{center}
    $0 \leq i < |ciudades| \yLuego res = \sum_{j=0}^{i-1} ciudades[j].habitantes \wedge v_{0}=|ciudades| - i$ \implies \par
    \vspace{5px}
    $0 \leq i < |ciudades| \yLuego |ciudades| - i - 1 < |ciudades| - i$ \equiv \par
    \vspace{5px}
    $True \yLuego True$ \equiv \par
    \vspace{5px}
    $True$ \par
    \vspace{5px}
    $I \wedge  B \wedge v_{0}=f_{v} \implies wp(S_{3};S_{4}, f_{v} < v_{0})$
\end{center}



\paragraph{$I \wedge f_{v} \leq 0 \implies \neg B$}
$I \wedge f_{v} \leq 0 \equiv 0 \leq i \leq |ciudades| \yLuego res = \sum_{j=0}^{i-1} ciudades[j].habitantes \wedge |ciudades| - i \leq 0$ \equiv \par
\begin{center}
    $0 \leq i \leq |ciudades| \yLuego res = \sum_{j=0}^{i-1} ciudades[j].habitantes \wedge |ciudades| \leq i$ \equiv \par
    \vspace{5px}
    $i = |ciudades| \yLuego res = \sum_{j=0}^{i-1} ciudades[j].habitantes $ \implies \par
    \vspace{5px}
    $i \geq |ciudades|$ \equiv \par
    \vspace{5px}
    $True$ \par
    \vspace{5px}
    $I \wedge f_{v} \leq 0 \implies \neg B$
\end{center}

\subsubsection{$P \implies wp(S_{1};S_{2}, Pc)$}
$wp(S_{1};S_{2}, Pc) \equiv wp(res = 0, wp(i = 0, Pc)) \equiv wp(res = 0, def(0) \yLuego Pc_{0}^{i})$ \equiv \par
\vspace{5px}
$wp(res = 0, True \yLuego res = 0 \wedge 0 = 0 \wedge A \wedge B \wedge C) $ \equiv \par
\vspace{5px}
$def(0) \yLuego (res = 0 \wedge True \wedge A \wedge B \wedge C)_{0}^{res} $ \equiv \par
\vspace{5px}
$True \yLuego 0 = 0 \wedge A \wedge B \wedge C \equiv True \wedge A \wedge B \wedge C \equiv  A \wedge B \wedge C $ \ \par
\vspace{20px}
$P \equiv A \wedge B \wedge C \implies A \wedge B \wedge C \equiv True \wedge True \wedge True \equiv True$ \par
\vspace{5px}
\begin{center}
    $P \implies wp(S_{1};S_{2}, Pc)$
\end{center}
El programa es correcto con respecto a su especificación.

\subsection{Demostrar que el valor devuelto es mayor a 50.000.}
Para demostrar que el valor devuelto es mayor a 50.000, cambiamos la Postcondición Q del programa acordemente y vemos si el programa sigue siendo correcto con respecto a su especificación.

Consideramos $P, B, Pc, f_{v}$ igual que en el punto anterior, y \\ \par
$Q \equiv Qc \equiv res = \sum_{j=0}^{|ciudades|-1} ciudades[j].habitantes \wedge res > 50000$ \\ \par
$A \equiv (\exists l: \ent)(0 \leq l < |ciudades| \yLuego ciudades[l].habitantes > 50000)$\\ \par
$I \equiv 0 \leq i \leq |ciudades| \yLuego res = \sum_{j=0}^{i-1} ciudades[j].habitantes \wedge A$
\end{document}
